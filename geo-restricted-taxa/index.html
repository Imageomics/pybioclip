
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../acknowledgments/">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.4">
    
    
      
        <title>Geo-Restricted Taxon List Predictions - pybioclip</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.8608ea7d.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../css/mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#improving-prediction-accuracy" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="pybioclip" class="md-header__button md-logo" aria-label="pybioclip" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            pybioclip
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Geo-Restricted Taxon List Predictions
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/Imageomics/pybioclip" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../command-line-tutorial/" class="md-tabs__link">
          
  
  Command Line Usage

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../python-tutorial/" class="md-tabs__link">
          
  
  Python Usage

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../docker/" class="md-tabs__link">
          
  
  Containers

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../acknowledgments/" class="md-tabs__link">
        
  
    
  
  Acknowledgments

      </a>
    </li>
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="./" class="md-tabs__link">
          
  
  Applications

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="pybioclip" class="md-nav__button md-logo" aria-label="pybioclip" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    pybioclip
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Imageomics/pybioclip" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Command Line Usage
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Command Line Usage
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../command-line-tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tutorial
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../command-line-help/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Help
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Python Usage
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Python Usage
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../python-tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tutorial
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../python-api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Containers
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Containers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../docker/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Docker
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../apptainer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Apptainer/Singularity
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../acknowledgments/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Acknowledgments
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Applications
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Applications
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Geo-Restricted Taxon List Predictions
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Geo-Restricted Taxon List Predictions
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prediction-using-a-geographically-restricted-list" class="md-nav__link">
    <span class="md-ellipsis">
      Prediction Using a Geographically Restricted List
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Prediction Using a Geographically Restricted List">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#getting-a-geographically-restricted-list-of-taxa" class="md-nav__link">
    <span class="md-ellipsis">
      Getting a Geographically Restricted List of Taxa
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Getting a Geographically Restricted List of Taxa">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gbif-web-interface-tutorial" class="md-nav__link">
    <span class="md-ellipsis">
      GBIF Web Interface Tutorial
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mol-web-interface-tutorial" class="md-nav__link">
    <span class="md-ellipsis">
      MOL Web Interface Tutorial
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples-using-a-geographically-restricted-list-of-taxa-for-prediction" class="md-nav__link">
    <span class="md-ellipsis">
      Examples Using a Geographically Restricted List of Taxa for Prediction
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prediction-using-a-geographically-restricted-list" class="md-nav__link">
    <span class="md-ellipsis">
      Prediction Using a Geographically Restricted List
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Prediction Using a Geographically Restricted List">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#getting-a-geographically-restricted-list-of-taxa" class="md-nav__link">
    <span class="md-ellipsis">
      Getting a Geographically Restricted List of Taxa
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Getting a Geographically Restricted List of Taxa">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gbif-web-interface-tutorial" class="md-nav__link">
    <span class="md-ellipsis">
      GBIF Web Interface Tutorial
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mol-web-interface-tutorial" class="md-nav__link">
    <span class="md-ellipsis">
      MOL Web Interface Tutorial
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples-using-a-geographically-restricted-list-of-taxa-for-prediction" class="md-nav__link">
    <span class="md-ellipsis">
      Examples Using a Geographically Restricted List of Taxa for Prediction
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="improving-prediction-accuracy">Improving Prediction Accuracy</h1>
<h2 id="prediction-using-a-geographically-restricted-list">Prediction Using a Geographically Restricted List</h2>
<p><code>pybioclip</code> provides three features for making predictions using a restricted set of terms:</p>
<ul>
<li><code>--cls</code></li>
<li><code>--bins</code></li>
<li><code>--subset</code></li>
</ul>
<p>One way to populate the restricted set of terms is to use taxa that are known to have been observed in a specific geographic region.</p>
<p>There are many ways to obtain a list with this constraint. Two noteworthy methods are:</p>
<ul>
<li>Using the <a href="https://www.gbif.org/">Global Biodiversity Information Facility (GBIF)</a> to download a list of taxa that have been observed in a specific geographic region.</li>
<li>Using <a href="https://mol.org/">Map of Life (MOL)</a> to download a list of taxa that have been observed in a specific geographic region.</li>
</ul>
<p>In our examples, we will use the image below of the nēnē, or the Hawaiian goose (<em>Branta sandvicensis</em>). Its full taxonomic classification is <em>Animalia Chordata Aves Anseriformes Anatidae Branta sandvicensis</em>. </p>
<p><strong>Save this image to your working directory as <code>nene.jpg</code> for the example.</strong></p>
<figure>
<p><img alt="picture of a nene" loading="lazy" src="https://inaturalist-open-data.s3.amazonaws.com/photos/13264181/medium.jpg" /></p>
<figcaption>
<p><a href="https://www.inaturalist.org/photos/13264181">© Kevin Schafer</a></p>
</figcaption>
</figure>
<h3 id="getting-a-geographically-restricted-list-of-taxa">Getting a Geographically Restricted List of Taxa</h3>
<p>Both <a href="https://www.gbif.org/">GBIF</a> and <a href="https://mol.org">MOL</a> provide web interfaces that enable users to produce a species list filtered by geographic coordinates and regions. A brief tutorial is provided. These examples illustrate a small subset of the capabilities provided by these platforms.</p>
<h4 id="gbif-web-interface-tutorial">GBIF Web Interface Tutorial</h4>
<p>You must have an account with GBIF to create downloads with a DOI. You do not need an account to download data with a DOI created by others.</p>
<p>Visit <a href="https://www.gbif.org/">https://www.gbif.org/</a> and click <code>Login</code> and <code>Register</code> to create an account.</p>
<p>Once you have an account, log in to manage data downloads from your profile.</p>
<div class="admonition example">
<p class="admonition-title">Example: filter for all occurrences of birds in the islands of Hawai'i with GBIF.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Rather than creating a new download, you may use <a href="https://doi.org/10.15468/dl.469rtz">https://doi.org/10.15468/dl.469rtz</a>, which was prepared for this example using the steps below. The information in this download may be different from a download you create, as more data is being added to GBIF regularly. Taxa have been extracted from the species list in this download and are available in:</p>
<ul>
<li><a href="../assets/hawaii_bird_species_list.txt">hawaii_bird_species_list.txt</a></li>
<li><a href="../assets/hawaii_bird_families_list.txt">hawaii_bird_families_list.txt</a></li>
<li><a href="../assets/hawaii_bird_family_bins_list.csv">hawaii_bird_family_bins_list.csv</a> (terms for bins of families were created manually)</li>
</ul>
<p>You can save these files to your working directory for the example.</p>
</div>
<ol>
<li>Log in to <a href="https://www.gbif.org/">https://www.gbif.org/</a> and click <code>OCCURRENCES</code> near the search bar.</li>
<li>Apply filters for your search (you can apply the filters in any combination and order).<ul>
<li>To filter by region, use <code>Location</code> with <code>Including coordinates</code>, <code>Administrative areas (gadm.org)</code>, <code>Country or area</code>, or <code>Continent</code>.</li>
<li>The <code>Location</code> feature is very flexible. You may use the built-in map widget to specify one or more regions with polygons or squares by hand. You may also specify one or more square ranges by entering precise coordinates into <code>Range</code> and/or <code>Geometry</code>. These features are able to be used in combination.</li>
<li>Under the <code>Scientific name</code> filter, type "Aves", and select "Aves Class" from the search results.</li>
<li>Under the <code>Location</code> filter, click <code>Geometry</code>, and enter the following into the "WKT or GeoJSON" field to specify the main eight islands of Hawai'i:
<div class="highlight"><pre><span></span><code>POLYGON((-160.54 18.54, -154.46 18.54, -154.46 22.26, -160.54 22.26, -160.54 18.54))
</code></pre></div><ul>
<li>You could also paste the equivalent raw content of the file <a href="assets/hawaii.geojson">hawaii.geojson</a> into the "WKT or GeoJSON" field under <code>Geometry</code>.</li>
</ul>
</li>
<li>Click <code>ADD</code></li>
</ul>
</li>
<li>Download the data.<ul>
<li>Once the query completes, click <code>DOWNLOAD</code>.</li>
<li>Select the <code>SPECIES LIST</code>, read and agree to the terms of use, and click <code>UNDERSTOOD</code>.</li>
<li>The download will be prepared and associated with the DOI displayed at the top of the page, and you will receive an email when it is ready. </li>
<li>The CSV will contain a list of taxa that meet the requirements of the filter with contents as defined by the <a href="https://techdocs.gbif.org/en/data-use/download-formats#species-list">GBIF "Species list" download format</a>.</li>
<li>You may extract contents of the CSV to a text file as you see fit for use with <code>pybioclip</code>, as we have with <code>hawaii_bird_species_list.txt</code>, <code>hawaii_bird_families_list.txt</code>, and <code>hawaii_bird_family_bins_list.csv</code>.</li>
</ul>
</li>
</ol>
</div>
<h4 id="mol-web-interface-tutorial">MOL Web Interface Tutorial</h4>
<p>There are no prerequisites. An account with MOL is optional and not required for downloading data. </p>
<p>Note that any URL shared for a filter applied to MOL will yield filter results as of the date the URL is used (rather than the date you applied the filter). You should host your own copy of the data if you need to ensure the data is static.</p>
<div class="admonition example">
<p class="admonition-title">Example: filter for all species of birds in the islands of Hawai'i with MOL.</p>
<ol>
<li>Visit <a href="https://mol.org/">https://mol.org/</a> and click <code>Regions</code>.</li>
<li>Under "Search for an area by name:", type "Hawai'i" and select "Hawai'i, United States".</li>
<li>Click <code>Go to Species Report</code>. This should take you to a page matching <a href="https://mol.org/regions/region/species?regiontype=region&amp;region_id=f470c3d3-03d2-4146-be2c-1b2f435a6eae">this URL</a>.</li>
<li>Under "Species", click <code>&lt;N&gt; Birds</code>, where <code>&lt;N&gt;</code> is the number of bird species in the region. This should append <code>&amp;group=birds</code> to the URL.</li>
<li>Refresh the browser to apply the Birds filter to the download. The filter will be applied when loading <a href="https://mol.org/regions/region/species?regiontype=region&amp;region_id=f470c3d3-03d2-4146-be2c-1b2f435a6eae&amp;group=birds">the URL</a> with the Birds filter applied. Note that if you download before refreshing, the download will include all species in the region.</li>
<li>Click <code>Download</code>, review the information in the pop-up about the download contents, and click <code>Download Now</code>.</li>
</ol>
</div>
<h3 id="examples-using-a-geographically-restricted-list-of-taxa-for-prediction">Examples Using a Geographically Restricted List of Taxa for Prediction</h3>
<p>These examples use the files containing information extracted from the GBIF download. You are encouraged to practice by creating similarly formatted files with the <code>scientific_name</code> and <code>family</code> columns from the <code>SpeciesList.csv</code> file in the MOL download.</p>
<div class="admonition example">
<p class="admonition-title">Example: Predict the species of an image using <a href="https://imageomics.github.io/pybioclip/command-line-tutorial/#predict-species-for-an-image">open-ended classification</a>.</p>
<p><div class="highlight"><pre><span></span><code><span class="go">bioclip predict --k 5 --format table nene.jpg</span>
</code></pre></div>
Output:
<div class="highlight"><pre><span></span><code><span class="go">+-----------+----------+----------+-------+--------------+----------+--------+-----------------+---------------------+----------------+---------------------+</span>
<span class="go">| file_name | kingdom  |  phylum  | class |    order     |  family  | genus  | species_epithet |       species       |  common_name   |        score        |</span>
<span class="go">+-----------+----------+----------+-------+--------------+----------+--------+-----------------+---------------------+----------------+---------------------+</span>
<span class="go">|  nene.jpg | Animalia | Chordata |  Aves |  Gruiformes  | Gruidae  |  Grus  |       grus      |      Grus grus      |  Common Crane  |  0.7501388788223267 |</span>
<span class="go">|  nene.jpg | Animalia | Chordata |  Aves |  Gruiformes  | Gruidae  |  Grus  |     communis    |    Grus communis    |                | 0.07198520749807358 |</span>
<span class="go">|  nene.jpg | Animalia | Chordata |  Aves | Anseriformes | Anatidae | Branta |   sandvicensis  | Branta sandvicensis | Hawaiian Goose | 0.04125870019197464 |</span>
<span class="go">|  nene.jpg | Animalia | Chordata |  Aves |  Gruiformes  | Gruidae  |  Grus  |     cinerea     |     Grus cinerea    |                | 0.03031359612941742 |</span>
<span class="go">|  nene.jpg | Animalia | Chordata |  Aves |  Gruiformes  | Gruidae  |  Grus  |     monacha     |     Grus monacha    |  Hooded Crane  | 0.02994249388575554 |</span>
<span class="go">+-----------+----------+----------+-------+--------------+----------+--------+-----------------+---------------------+----------------+---------------------+</span>
</code></pre></div></p>
<div class="admonition warning">
<p class="admonition-title">Incorrect top predictions.</p>
<p>The top two predictions are incorrect. This suggests that filtering the possibilities for predicted labels may improve the accuracy of the predictions.</p>
</div>
</div>
<p>We can imagine that all we know about the image is that it was taken on one of the Hawaiian islands. We can use multiple approaches incorporating the geographically restricted lists to make a more informed decision. </p>
<div class="admonition example">
<p class="admonition-title">Example: Predict the species of an image using the geographically restricted list of species directly as <a href="https://imageomics.github.io/pybioclip/command-line-tutorial/#custom-label-predictions">custom labels</a>.</p>
<p>Using <a href="../assets/hawaii_bird_species_list.txt">hawaii_bird_species_list.txt</a>:
<div class="highlight"><pre><span></span><code><span class="go">bioclip predict --k 3 --format table --cls hawaii_bird_species_list.txt nene.jpg</span>
</code></pre></div>
Output:
<div class="highlight"><pre><span></span><code><span class="go">+-----------+---------------------+---------------------+</span>
<span class="go">| file_name |    classification   |        score        |</span>
<span class="go">+-----------+---------------------+---------------------+</span>
<span class="go">|  nene.jpg | Branta sandvicensis |  0.7710946798324585 |</span>
<span class="go">|  nene.jpg |    Rhea americana   | 0.10109006613492966 |</span>
<span class="go">|  nene.jpg |   Branta leucopsis  |  0.0416080504655838 |</span>
<span class="go">+-----------+---------------------+---------------------+</span>
</code></pre></div>
Advantages of this approach:</p>
<ul>
<li><strong>Prediction accuracy</strong>: The predictions are more accurate because they are limited to species that are known to be present in the geographic region.</li>
</ul>
<p>Disadvantages of this approach:</p>
<ul>
<li><strong>Performance</strong>: The prediction is slow because the embeddings must be calculated for all species in the list. See the following examples for approaches to speed up prediction.</li>
<li><strong>Potential misses</strong>: The predictions are limited to the species in the list, which may not include the correct species if it is an anomalous occurrence.</li>
</ul>
</div>
<div class="admonition example">
<p class="admonition-title">Example: Predict the species of an image by combining the geographically restricted list with the precomputed embeddings of the <a href="https://imageomics.github.io/pybioclip//command-line-tutorial/#predict-using-a-tol-subset">TOL subset</a> of taxa.</p>
<p>Obtain the TOL subset.
<div class="highlight"><pre><span></span><code><span class="go">bioclip list-tol-taxa &gt; tol_subset.csv</span>
</code></pre></div></p>
<p>Filter the TOL subset to include only the geographically restricted list in <a href="../assets/hawaii_bird_species_list.txt">hawaii_bird_species_list.txt</a>. For example, with Pandas in Python:
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="c1"># Load the TOL subset.</span>
<span class="n">df_tol</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;tol_subset.csv&#39;</span><span class="p">)</span>

<span class="c1"># Load the list of species.</span>
<span class="n">df_species</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;hawaii_bird_species_list.txt&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;species&#39;</span><span class="p">])</span>

<span class="c1"># Merge the TOL subset with the list of species, inner merge</span>
<span class="n">df_merged</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_tol</span><span class="p">,</span> <span class="n">df_species</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;species&#39;</span><span class="p">)</span>

<span class="c1"># Save the merged list to a file to use with the --subset option.</span>
<span class="n">df_merged</span><span class="p">[</span><span class="s2">&quot;species&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;tol_subset_species_filtered.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></p>
<p>Predict using the filtered TOL subset.
<div class="highlight"><pre><span></span><code><span class="go">bioclip predict --k 3 --format table --subset tol_subset_species_filtered.csv nene.jpg</span>
</code></pre></div>
Output:
<div class="highlight"><pre><span></span><code><span class="go">+-----------+----------+----------+-------+--------------+----------+--------------+-----------------+---------------------+------------------+---------------------+</span>
<span class="go">| file_name | kingdom  |  phylum  | class |    order     |  family  |    genus     | species_epithet |       species       |   common_name    |       </span>
<span class="go">score        |</span>
<span class="go">+-----------+----------+----------+-------+--------------+----------+--------------+-----------------+---------------------+------------------+---------------------+</span>
<span class="go">|  nene.jpg | Animalia | Chordata |  Aves | Anseriformes | Anatidae |    Branta    |   sandvicensis  | Branta sandvicensis |  Hawaiian Goose  |  0.7040964365005493 |</span>
<span class="go">|  nene.jpg | Animalia | Chordata |  Aves |  Rheiformes  | Rheidae  |     Rhea     |    americana    |    Rhea americana   |   Greater Rhea   | 0.18546675145626068 |</span>
<span class="go">|  nene.jpg | Animalia | Chordata |  Aves |  Gruiformes  | Gruidae  | Anthropoides |      virgo      |  Anthropoides virgo | Demoiselle Crane | 0.04178838059306145 |</span>
<span class="go">+-----------+----------+----------+-------+--------------+----------+--------------+-----------------+---------------------+------------------+---------------------+</span>
</code></pre></div></p>
<p>Advantages of this approach:</p>
<ul>
<li><strong>Performance</strong>: Significant speedup in prediction time because the embeddings are precomputed.</li>
<li><strong>Prediction accuracy</strong>: The predictions are more accurate than open-ended prediction alone because they are limited to species that are known to be present in the geographic region.</li>
</ul>
<p>Disadvantages of this approach:</p>
<ul>
<li><strong>Potential misses</strong>: Only taxa in the TOL subset can be included in the geographically restricted list, which may exclude entries present in the external list.</li>
</ul>
</div>
<div class="admonition example">
<p class="admonition-title">Example: Predict the species of an image combining open-ended classification with the geographically restricted list using <a href="https://imageomics.github.io/pybioclip/command-line-tutorial/#predict-from-a-list-of-classes">custom labels</a>.</p>
<p>This approach will produce two outputs, an unconstrained open-ended prediction and a prediction constrained by the geographically restricted list for comparison.</p>
<p>Predict the top 20 species with open-ended classification, saving the predictions to a file.
<div class="highlight"><pre><span></span><code><span class="go">bioclip predict --k 20 nene.jpg &gt; bioclip_species_predictions_oe.csv</span>
</code></pre></div>
Filter the predictions using the geographically restricted list of species in <a href="../assets/hawaii_bird_species_list.txt">hawaii_bird_species_list.txt</a>. E.g. using Pandas in Python.
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="c1"># Load the open-ended predictions.</span>
<span class="n">df_predictions</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;bioclip_species_predictions_oe.csv&#39;</span><span class="p">)</span>

<span class="c1"># Load the geographically restricted list of species.</span>
<span class="n">df_hawaii_species</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;hawaii_bird_species_list.txt&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;species&#39;</span><span class="p">])</span>

<span class="c1"># Filter the predictions to include only species in the geographically restricted list.</span>
<span class="n">df_merged</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_predictions</span><span class="p">,</span> <span class="n">df_hawaii_species</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;species&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">)</span>

<span class="c1"># Save the filtered list to a file to use with the --cls option.</span>
<span class="n">df_merged</span><span class="p">[</span><span class="s2">&quot;species&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;bioclip_species_predictions_filtered.txt&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>
In this example, this step removes the option to predict the crane species <em>Grus grus</em> and <em>Grus communis</em>, which are not found in Hawai'i.</p>
<p>Predict the species using the filtered list.
<div class="highlight"><pre><span></span><code><span class="go">bioclip predict --k 3 --format table --cls bioclip_species_predictions_filtered.txt nene.jpg</span>
</code></pre></div>
Output:
<div class="highlight"><pre><span></span><code><span class="go">+-----------+---------------------+---------------------+</span>
<span class="go">| file_name |    classification   |        score        |</span>
<span class="go">+-----------+---------------------+---------------------+</span>
<span class="go">|  nene.jpg | Branta sandvicensis |  0.8363304734230042 |</span>
<span class="go">|  nene.jpg |    Rhea americana   | 0.10964243859052658 |</span>
<span class="go">|  nene.jpg |   Anser cygnoides   | 0.02564687840640545 |</span>
<span class="go">+-----------+---------------------+---------------------+</span>
</code></pre></div>
Advantages of this approach:</p>
<ul>
<li><strong>Anomaly detection</strong>: In the case of an anomalous occurrence--a true sighting of an organism that has not been recorded in that region previously--we have BioCLIP's first best guess handy in <code>bioclip_species_predictions_oe.csv</code>, which is not constrained by the geographical list. This may be useful for flagging a novel invasive species or otherwise undocumented sighting.</li>
<li><strong>Performance</strong>: The long geographically restricted list is reasonably pruned, which speeds up prediction, giving <code>bioclip_species_predictions_filtered.txt</code>.</li>
<li><strong>Balanced approach</strong>: This may be a good balanced approach if there is uncertainty about the origin of the organism in the image.</li>
</ul>
<p>Disadvantages of this approach:</p>
<ul>
<li><strong>Potential misses</strong>: The primary filter is the open-ended classification, which may not include the correct prediction if <code>-k</code> is set too low or in challenging cases.</li>
</ul>
</div>
<div class="admonition example">
<p class="admonition-title">Example: Predict the family of an image among bird families in Hawai'i as <a href="https://imageomics.github.io/pybioclip/command-line-tutorial/#custom-label-predictions">custom labels</a>.</p>
<p>Using <a href="../assets/hawaii_bird_families_list.txt">hawaii_bird_families_list.txt</a>:
<div class="highlight"><pre><span></span><code><span class="go">bioclip predict --k 3 --format table --cls hawaii_bird_families_list.txt nene.jpg</span>
</code></pre></div>
Output:
<div class="highlight"><pre><span></span><code><span class="go">+-----------+----------------+---------------------+</span>
<span class="go">| file_name | classification |        score        |</span>
<span class="go">+-----------+----------------+---------------------+</span>
<span class="go">|  nene.jpg |    Anatidae    | 0.34369930624961853 |</span>
<span class="go">|  nene.jpg |   Ciconiidae   | 0.28970828652381897 |</span>
<span class="go">|  nene.jpg |    Gruidae     | 0.17063161730766296 |</span>
<span class="go">+-----------+----------------+---------------------+</span>
</code></pre></div></p>
</div>
<div class="admonition example">
<p class="admonition-title">Example: Predict a custom <a href="https://imageomics.github.io/pybioclip/command-line-tutorial/#predict-from-a-binning-csv">binned classification</a> of an image using the binned list of families.</p>
<p>Using <a href="../assets/hawaii_bird_family_bins_list.csv">hawaii_bird_family_bins_list.csv</a>:
<div class="highlight"><pre><span></span><code><span class="go">bioclip predict --k 3 --format table --bins hawaii_bird_family_bins_list.csv nene.jpg</span>
</code></pre></div>
Output:
<div class="highlight"><pre><span></span><code><span class="go">+-----------+-----------------------+---------------------+</span>
<span class="go">| file_name |     classification    |        score        |</span>
<span class="go">+-----------+-----------------------+---------------------+</span>
<span class="go">|  nene.jpg |       Waterfowl       |  0.3437104821205139 |</span>
<span class="go">|  nene.jpg | Shorebirds/Waterbirds |  0.3415525555610657 |</span>
<span class="go">|  nene.jpg |         Cranes        | 0.17063717544078827 |</span>
<span class="go">+-----------+-----------------------+---------------------+</span>
</code></pre></div></p>
</div>
<div class="admonition example">
<p class="admonition-title">Example: Predict the order rank of an image by combining the geographically restricted list with the precomputed embeddings of the <a href="https://imageomics.github.io/pybioclip//command-line-tutorial/#predict-using-a-tol-subset">TOL subset</a> of taxa.</p>
<p>This example is similar to the earlier example using the TOL subset, but using a higher taxonomic rank with this approach has some considerations to keep in mind, as we will explore.</p>
<p>This example also requires you to preprocess a list of custom labels yourself. </p>
<p>To do so, download the GBIF filtered species list prepared at <a href="https://doi.org/10.15468/dl.469rtz">https://doi.org/10.15468/dl.469rtz</a>. Extract the file <code>0001260-250123221155621.csv</code> to your working directory. Note that the delimiter in this file is the tab character (<code>\t</code>). </p>
<p>Retrieve the TOL subset.
<div class="highlight"><pre><span></span><code><span class="go">bioclip list-tol-taxa &gt; tol_subset.csv</span>
</code></pre></div>
Filter the TOL subset to include only the geographically restricted list of bird orders in <code>0001260-250123221155621.csv</code>. For example, with Pandas in Python: 
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="c1"># Load the TOL subset.</span>
<span class="n">df_tol</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;tol_subset.csv&#39;</span><span class="p">)</span>

<span class="c1"># Load the CSV from GBIF containing taxonomic data of bird species in Hawai&#39;i.</span>
<span class="n">df_gbif</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;0001260-250123221155621.csv&#39;</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1"># Filter the GBIF list to include only bird orders.</span>
<span class="n">df_gbif_orders</span> <span class="o">=</span> <span class="n">df_gbif</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>

<span class="c1"># Merge the orders from the TOL subset with the orders from GBIF. inner merge</span>
<span class="n">df_merged</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_tol</span><span class="p">,</span> <span class="n">df_gbif_orders</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;order&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">)</span>

<span class="c1"># Save the merged list to a file to use with the --subset option.</span>
<span class="n">df_merged</span><span class="p">[</span><span class="s2">&quot;order&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;tol_subset_orders_filtered.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></p>
<p>Predict using the filtered TOL subset.
<div class="highlight"><pre><span></span><code><span class="go">bioclip predict --k 3 --format table --subset tol_subset_orders_filtered.csv nene.jpg</span>
</code></pre></div>
Output:
<div class="highlight"><pre><span></span><code><span class="go">+-----------+----------+----------+-------+--------------+----------+--------+-----------------+---------------------+----------------+---------------------+</span>
<span class="go">| file_name | kingdom  |  phylum  | class |    order     |  family  | genus  | species_epithet |       species       |  common_name   |    </span>
<span class="go">    score        |</span>
<span class="go">+-----------+----------+----------+-------+--------------+----------+--------+-----------------+---------------------+----------------+---------------------+</span>
<span class="go">|  nene.jpg | Animalia | Chordata |  Aves |  Gruiformes  | Gruidae  |  Grus  |       grus      |      Grus grus      |  Common Crane  |  0.7614361047744751 |</span>
<span class="go">|  nene.jpg | Animalia | Chordata |  Aves |  Gruiformes  | Gruidae  |  Grus  |     communis    |    Grus communis    |                | 0.07306931912899017 |</span>
<span class="go">|  nene.jpg | Animalia | Chordata |  Aves | Anseriformes | Anatidae | Branta |   sandvicensis  | Branta sandvicensis | Hawaiian Goose | 0.04188006371259689 |</span>
<span class="go">+-----------+----------+----------+-------+--------------+----------+--------+-----------------+---------------------+----------------+---------------------+</span>
</code></pre></div></p>
<div class="admonition warning">
<p class="admonition-title">Incorrect top predictions: when <em>not</em> to use <code>--subset</code> to speed up prediction.</p>
<p>There are a few things to note about this output:</p>
<ul>
<li>The top predictions are incorrect as with the open-ended classification example.</li>
<li>The prediction is specified to the species rank though our <code>--subset</code> file contains orders. This is expected behavior.<ul>
<li>All of the species (and orders) that are not known by GBIF to be present in Hawai'i are excluded from <code>tol_subset_orders_filtered.csv</code>--however, filtering by higher-rank taxa does not eliminate non-local species. That is, even though <em>Grus grus</em> and <em>Grus communis</em> (members of order <em>Gruiformes</em>, i.e. "crane-like") are not found in Hawai'i, other members of the order <em>Gruiformes</em> are found in Hawai'i according to GBIF. Since the <code>--subset</code> method predicts to species level, these species are included in the prediction.</li>
<li>In other words, if just one species of a higher-rank taxon is found in the geographic region, all species of that taxon will be included in the prediction when using <code>--subset</code>.</li>
</ul>
</li>
<li>In this case, it is not advisable to use higher taxa in the geographically restricted list for use with <code>--subset</code> without additional filtering.</li>
</ul>
</div>
<p>If you know that the organism in your image is <em>not</em> from the order <em>Gruiformes</em> (and others), you can exclude that term (and others) from the filtered list. This will improve the accuracy of the predictions.</p>
<p>In Python:
<div class="highlight"><pre><span></span><code><span class="c1"># Following the merge step between the TOL subset and the GBIF orders, remove the term Gruiformes from the list.</span>
<span class="n">df_merged</span> <span class="o">=</span> <span class="n">df_merged</span><span class="p">[</span><span class="n">df_merged</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;Gruiformes&#39;</span><span class="p">]</span>

<span class="c1"># Save the filtered list to a file to use with the --subset option.</span>
<span class="n">df_merged</span><span class="p">[</span><span class="s2">&quot;order&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;tol_subset_orders_filtered.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
Predicting with the new filtered list:
<div class="highlight"><pre><span></span><code><span class="go">bioclip predict --k 3 --format table --subset tol_subset_orders_filtered.csv nene.jpg</span>
</code></pre></div>
Output:
<div class="highlight"><pre><span></span><code><span class="go">+-----------+----------+----------+-------+--------------+-------------+--------------+-----------------+-----------------------+----------------+---------------------+</span>
<span class="go">| file_name | kingdom  |  phylum  | class |    order     |    family   |    genus     | species_epithet |        species        |  common_name   |        score        |</span>
<span class="go">+-----------+----------+----------+-------+--------------+-------------+--------------+-----------------+-----------------------+----------------+---------------------+</span>
<span class="go">|  nene.jpg | Animalia | Chordata |  Aves | Anseriformes |   Anatidae  |    Branta    |   sandvicensis  |  Branta sandvicensis  | Hawaiian Goose |  0.4851439893245697 |</span>
<span class="go">|  nene.jpg | Animalia | Chordata |  Aves |  Rheiformes  |   Rheidae   |     Rhea     |    americana    |     Rhea americana    |  Greater Rhea  | 0.12779226899147034 |</span>
<span class="go">|  nene.jpg | Animalia | Chordata |  Aves | Galliformes  | Phasianidae | Tetraogallus |     altaicus    | Tetraogallus altaicus | Altai Snowcock | 0.10936115682125092 |</span>
<span class="go">+-----------+----------+----------+-------+--------------+-------------+--------------+-----------------+-----------------------+----------------+---------------------+</span>
</code></pre></div></p>
</div>
<p>It could be sensible to use <code>--subset</code> with higher taxa if:</p>
<ul>
<li>You want to speed up predictions by using precomputed embeddings.</li>
<li>You are confident that the species in the higher taxa are all found in the filtered list of higher taxa labels (e.g. if you know it belongs to a certain order but some other order has species that look confusingly similar, you can exclude the other order from the list).</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.tabs.sticky", "content.code.copy", "content.code.annotate"], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.f1b6f286.min.js"></script>
      
    
  </body>
</html>